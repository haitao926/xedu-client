<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jupyter Notebook Client</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
        }
        .header h1 {
            font-size: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .header p {
            color: #666;
            font-size: 14px;
        }
        .nav-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        .nav-tab {
            flex: 1;
            padding: 20px 30px;
            background: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }
        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .card h2 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        .drop-zone {
            border: 3px dashed #667eea;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
            transition: all 0.3s;
            cursor: pointer;
        }
        .drop-zone:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #764ba2;
        }
        .drop-zone.dragover {
            background: rgba(102, 126, 234, 0.2);
            border-color: #764ba2;
            transform: scale(1.02);
        }
        .drop-zone .icon {
            font-size: 64px;
            margin-bottom: 15px;
        }
        .drop-zone .text {
            font-size: 18px;
            color: #667eea;
            font-weight: 600;
        }
        .drop-zone .hint {
            font-size: 13px;
            color: #666;
            margin-top: 10px;
        }
        .path-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border-left: 4px solid #667eea;
        }
        .path-display label {
            display: block;
            font-size: 11px;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            font-weight: 600;
        }
        .path-display .value {
            color: #333;
            word-break: break-all;
        }
        .file-list-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border-left: 4px solid #667eea;
        }
        .file-list-display label {
            display: block;
            font-size: 11px;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            font-weight: 600;
        }
        .file-list-display .value {
            color: #333;
            max-height: 200px;
            overflow-y: auto;
        }
        .file-item {
            padding: 4px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        .file-item:last-child {
            border-bottom: none;
        }
        .file-name {
            color: #333;
            font-weight: 500;
        }
        .file-info {
            color: #666;
            font-size: 12px;
            margin-left: 10px;
        }
        .status-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 20px;
        }
        .status-running {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            animation: pulse 2s infinite;
        }
        .status-stopped {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .status-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        .status-item label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            font-weight: 600;
        }
        .status-item .value {
            font-size: 18px;
            font-weight: 700;
            color: #333;
        }
        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .btn {
            flex: 1;
            min-width: 120px;
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 700;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        .btn-info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            height: 300px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .log-line {
            margin-bottom: 8px;
            padding: 4px 0;
        }
        .log-time {
            color: #6a9955;
            margin-right: 10px;
        }
        .log-info { color: #4fc1ff; }
        .log-success { color: #89d185; }
        .log-error { color: #f48771; }
        .log-warn { color: #dcdcaa; }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        .alert {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #fbbf24;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .alert strong {
            color: #d97706;
        }
        .full-width {
            grid-column: 1 / -1;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .info-card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        .info-card .value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .info-card p {
            font-size: 12px;
            opacity: 0.8;
        }

        /* ========== AIåŠ©æ‰‹é¡µé¢æ ·å¼ ========== */

        /* AIä¸Šä¼ åŒºåŸŸ */
        .ai-drop-zone {
            border: 3px dashed #667eea;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
            transition: all 0.3s;
            cursor: pointer;
        }
        .ai-drop-zone:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #764ba2;
            transform: translateY(-2px);
        }
        .ai-drop-zone.dragover {
            background: rgba(102, 126, 234, 0.2);
            border-color: #764ba2;
            transform: scale(1.02);
        }
        .ai-drop-zone .icon {
            font-size: 64px;
            margin-bottom: 15px;
        }
        .ai-drop-zone .text {
            font-size: 18px;
            color: #667eea;
            font-weight: 600;
        }
        .ai-drop-zone .hint {
            font-size: 13px;
            color: #666;
            margin-top: 10px;
        }

        /* å›¾ç‰‡é¢„è§ˆ */
        .image-preview-container {
            position: relative;
            display: inline-block;
            max-width: 100%;
        }
        .preview-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: block;
        }
        .remove-image-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .remove-image-btn:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        /* AIé—®é¢˜è¾“å…¥ */
        .ai-textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 15px;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s;
            background: white;
        }
        .ai-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* æé—®æŒ‰é’® */
        .btn-ask {
            width: 100%;
            padding: 18px 30px;
            margin-top: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-ask:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        .btn-ask:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* å¯¹è¯å¤´éƒ¨ */
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .chat-header h2 {
            margin: 0;
            font-size: 20px;
        }
        .btn-clear-chat {
            padding: 10px 20px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
        }
        .btn-clear-chat:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.5);
        }

        /* å¯¹è¯å®¹å™¨ - å‚è€ƒChatGPT */
        .chat-container {
            background: #ffffff;
            border-radius: 12px;
            padding: 0;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
        }

        /* ç©ºçŠ¶æ€ */
        .chat-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px;
            text-align: center;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
        }
        .chat-empty-icon {
            font-size: 100px;
            margin-bottom: 30px;
            opacity: 0.3;
        }
        .chat-empty-text {
            font-size: 18px;
            color: #666;
            line-height: 1.8;
            font-weight: 500;
        }

        /* èŠå¤©æ°”æ³¡ - å‚è€ƒä¸“ä¸šAIèŠå¤© */
        .chat-message {
            display: flex;
            gap: 16px;
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            animation: fadeIn 0.4s ease-in;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-message:last-child {
            border-bottom: none;
        }

        .chat-message.answer {
            background: #f8f9fa;
        }

        .chat-message.question {
            background: #ffffff;
        }

        /* å¤´åƒ */
        .message-avatar {
            flex-shrink: 0;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .message-avatar.ai-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .message-avatar.user-avatar {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        /* æ¶ˆæ¯å†…å®¹åŒºåŸŸ */
        .message-content-wrapper {
            flex: 1;
            min-width: 0;
        }

        /* æ¶ˆæ¯å¤´éƒ¨ */
        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .message-sender {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .message-time {
            font-size: 12px;
            color: #999;
        }

        /* æ¶ˆæ¯æ–‡æœ¬ */
        .message-content {
            font-size: 15px;
            line-height: 1.7;
            color: #333;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* ä»£ç å—æ ·å¼ */
        .message-content code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #e91e63;
        }

        .message-content pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
        }

        .message-content pre code {
            background: transparent;
            padding: 0;
            color: #d4d4d4;
        }

        /* åˆ—è¡¨æ ·å¼ */
        .message-content ul, .message-content ol {
            margin: 12px 0;
            padding-left: 24px;
        }

        .message-content li {
            margin: 6px 0;
        }

        /* å¼•ç”¨æ ·å¼ */
        .message-content blockquote {
            border-left: 4px solid #667eea;
            padding-left: 16px;
            margin: 12px 0;
            color: #666;
            font-style: italic;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .chat-container::-webkit-scrollbar {
            width: 8px;
        }
        .chat-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        .chat-container::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }
        .chat-container::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        /* AIèŠå¤©å¸ƒå±€ - ä¾§è¾¹æ  */
        .ai-chat-layout {
            display: flex;
            height: calc(100vh - 200px);
            gap: 0;
        }

        /* å·¦ä¾§è¾¹æ  */
        .chat-sidebar {
            width: 200px;
            background: #f8f9fa;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .sidebar-header h3 {
            margin: 0 0 12px 0;
            font-size: 16px;
            color: #333;
        }

        .btn-new-chat {
            width: 100%;
            padding: 10px 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-new-chat:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        /* èŠå¤©åˆ—è¡¨ */
        .chat-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .chat-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 5px;
        }

        .chat-item:hover {
            background: #e5e7eb;
        }

        .chat-item.active {
            background: #667eea;
            color: white;
        }

        .chat-item-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .chat-item.active .chat-item-icon {
            background: rgba(255, 255, 255, 0.2);
        }

        .chat-item-info {
            flex: 1;
            min-width: 0;
        }

        .chat-item-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-item-preview {
            font-size: 12px;
            opacity: 0.7;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* å³ä¾§ä¸»åŒºåŸŸ */
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .chat-main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            background: white;
        }

        .chat-main-header h2 {
            margin: 0;
            font-size: 20px;
            color: #333;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn-clear-current {
            padding: 8px 16px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .btn-clear-current:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        /* èŠå¤©å®¹å™¨è°ƒæ•´ */
        .chat-container {
            flex: 1;
            background: #ffffff;
            overflow-y: auto;
            padding: 0;
            max-height: none;
        }

        /* åº•éƒ¨è¾“å…¥åŒºè°ƒæ•´ */
        .ai-input-fixed {
            position: relative;
            bottom: auto;
            left: auto;
            transform: none;
            width: 100%;
            max-width: none;
            padding: 16px 24px;
            background: white;
            border-top: 1px solid #e5e7eb;
        }

        /* è¾“å…¥å›¾ç‰‡é¢„è§ˆ */
        .input-image-preview {
            margin-bottom: 8px;
            animation: slideDown 0.3s ease-in;
        }
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .input-image-container {
            position: relative;
            display: inline-block;
            max-width: 200px;
        }

        .input-preview-image {
            max-width: 200px;
            max-height: 150px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: block;
        }

        .input-image-container .remove-image-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .input-image-container .remove-image-btn:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .ai-input-container {
            display: flex;
            gap: 10px;
            background: #f8f9fa;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 12px;
            transition: all 0.3s;
        }

        .ai-input-container:focus-within {
            border-color: #667eea;
            background: white;
        }

        .btn-attach {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: none;
            background: #e5e7eb;
            color: #666;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .btn-attach:hover {
            background: #d1d5db;
            transform: scale(1.05);
        }

        .ai-textarea-fixed {
            flex: 1;
            border: none;
            outline: none;
            resize: none;
            font-size: 15px;
            line-height: 1.6;
            font-family: inherit;
            max-height: 300px;
            padding: 12px 8px;
            background: transparent;
        }

        .ai-textarea-fixed::placeholder {
            color: #999;
        }

        .btn-send {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .btn-send:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-send:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .ai-input-hint {
            text-align: center;
            font-size: 12px;
            color: #999;
            margin-top: 6px;
            user-select: none;
        }

        /* æ»šåŠ¨æ¡æ ·å¼æ›´æ–° */
        .chat-list::-webkit-scrollbar,
        .chat-container::-webkit-scrollbar {
            width: 8px;
        }
        .chat-list::-webkit-scrollbar-track,
        .chat-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        .chat-list::-webkit-scrollbar-thumb,
        .chat-container::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }
        .chat-list::-webkit-scrollbar-thumb:hover,
        .chat-container::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ ‡é¢˜ -->
        <div class="header">
            <h1>âš¡ Jupyter Notebook Client</h1>
            <p>ä¸“ä¸šçš„ Jupyter Notebook æ¡Œé¢ç®¡ç†å·¥å…· | Python Flask API + Web å‰ç«¯</p>
            <p style="margin-top: 10px; font-size: 12px;">API æœåŠ¡å™¨: <strong>http://127.0.0.1:5000</strong></p>
        </div>

        <!-- å¯¼èˆªæ ‡ç­¾ -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('main')">
                ğŸ  ä¸»æ§åˆ¶å°
            </button>
            <button class="nav-tab" onclick="showTab('settings')">
                âš™ï¸ ç³»ç»Ÿè®¾ç½®
            </button>
            <button class="nav-tab" onclick="showTab('ai-assistant')">
                ğŸ¤– AI åŠ©æ‰‹
            </button>
        </div>

        <!-- ä¸»æ§åˆ¶å° -->
        <div id="main" class="tab-content active">
            <div class="main-content">
                <!-- é¡¹ç›®è®¾ç½® -->
                <div class="card">
                    <h2>ğŸ“ é¡¹ç›®è®¾ç½®</h2>

                    <div class="drop-zone" id="drop-zone" onclick="document.getElementById('folder-input').click()">
                        <div class="icon">ğŸ“‚</div>
                        <div class="text">æ‹–æ‹½æ–‡ä»¶å¤¹åˆ°è¿™é‡Œæˆ–ç‚¹å‡»é€‰æ‹©</div>
                        <div class="hint">æ”¯æŒå°†é¡¹ç›®æ–‡ä»¶å¤¹æ‹–æ‹½åˆ°æ­¤å¤„</div>
                        <input type="file" id="folder-input" webkitdirectory directory multiple style="display: none;">
                    </div>

                    <div class="path-display" style="margin-top: 20px;">
                        <label>é¡¹ç›®ç›®å½•è·¯å¾„</label>
                        <input type="text" id="project-path" placeholder="ä¾‹å¦‚: C:\Users\ç”¨æˆ·å\Documents\é¡¹ç›®æ–‡ä»¶å¤¹" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; margin-bottom: 10px;">
                        <button class="btn btn-info" onclick="confirmProjectPath()" style="width: 100%; margin-top: 5px;">
                            <span>âœ“</span> ç¡®è®¤è·¯å¾„
                        </button>
                    </div>
                    <div class="file-list-display" id="file-list" style="display: none;">
                        <label>é¡¹ç›®æ–‡ä»¶åˆ—è¡¨</label>
                        <div class="value" id="file-list-content">-</div>
                    </div>
                </div>

                <!-- Jupyter æ§åˆ¶ -->
                <div class="card">
                    <h2>ğŸ”´ Jupyter Notebook æ§åˆ¶</h2>
                    <span id="jupyter-status" class="status-badge status-stopped">æœªçŸ¥</span>

                    <div class="status-grid">
                        <div class="status-item">
                            <label>è¿è¡ŒçŠ¶æ€</label>
                            <div class="value" id="status-value">æ£€æŸ¥ä¸­...</div>
                        </div>
                        <div class="status-item">
                            <label>æœåŠ¡ç«¯å£</label>
                            <div class="value" id="port-value">-</div>
                        </div>
                        <div class="status-item">
                            <label>è¿›ç¨‹ ID</label>
                            <div class="value" id="pid-value">-</div>
                        </div>
                        <div class="status-item">
                            <label>è®¿é—®åœ°å€</label>
                            <div class="value" id="url-value" style="font-size: 14px;">-</div>
                        </div>
                    </div>

                    <div class="btn-group" style="margin-top: 20px;">
                        <button id="start-btn" class="btn btn-success" onclick="startJupyter()">
                            <span>â–¶</span> å¯åŠ¨ Notebook
                        </button>
                        <button id="stop-btn" class="btn btn-danger" onclick="stopJupyter()">
                            <span>â¹</span> åœæ­¢ Notebook
                        </button>
                        <button id="restart-btn" class="btn btn-warning" onclick="restartJupyter()">
                            <span>â†»</span> é‡å¯ Notebook
                        </button>
                        <button id="open-btn" class="btn btn-info" onclick="openBrowser()">
                            <span>ğŸŒ</span> æ‰“å¼€æµè§ˆå™¨
                        </button>
                    </div>
                </div>

                <!-- å®æ—¶æ—¥å¿— -->
                <div class="card full-width">
                    <h2>ğŸ“ å®æ—¶æ—¥å¿—</h2>
                    <div id="log-container" class="log-container">
                        <div class="log-line log-info">
                            <span class="log-time">[--:--:--]</span>
                            ç³»ç»Ÿå¯åŠ¨ï¼Œç­‰å¾… Jupyter Notebook Client åˆå§‹åŒ–...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç³»ç»Ÿè®¾ç½® -->
        <div id="settings" class="tab-content">
            <!-- ç³»ç»Ÿä¿¡æ¯ -->
            <div class="card" style="margin-bottom: 20px;">
                <h2>ğŸ“Š ç³»ç»Ÿä¿¡æ¯</h2>
                <div class="info-grid">
                    <div class="info-card">
                        <h3>Python ç‰ˆæœ¬</h3>
                        <div class="value" id="python-version">-</div>
                        <p>å½“å‰ Python è§£é‡Šå™¨ç‰ˆæœ¬</p>
                    </div>
                    <div class="info-card">
                        <h3>Jupyter ç‰ˆæœ¬</h3>
                        <div class="value" id="jupyter-version">-</div>
                        <p>Jupyter Notebook æ¡†æ¶ç‰ˆæœ¬</p>
                    </div>
                    <div class="info-card">
                        <h3>æ“ä½œç³»ç»Ÿ</h3>
                        <div class="value" id="os-info">-</div>
                        <p>å½“å‰è¿è¡Œå¹³å°</p>
                    </div>
                    <div class="info-card">
                        <h3>API çŠ¶æ€</h3>
                        <div class="value" id="api-status">-</div>
                        <p>Flask API è¿æ¥çŠ¶æ€</p>
                    </div>
                </div>
            </div>

            <!-- é…ç½®è®¾ç½® -->
            <div class="card" style="margin-bottom: 20px;">
                <h2>âš™ï¸ Python ç¯å¢ƒé…ç½®</h2>
                <div class="form-group">
                    <label>Python è§£é‡Šå™¨è·¯å¾„</label>
                    <input type="text" id="config-python-path" placeholder="ä¾‹: C:\Python313\python.exe">
                </div>
                <div class="form-group">
                    <label>Jupyter ç«¯å£å·</label>
                    <input type="number" id="config-port" value="8888" min="1024" max="65535">
                </div>
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="loadConfigFromServer()">
                        <span>ğŸ”„</span> é‡æ–°åŠ è½½é…ç½®
                    </button>
                    <button class="btn btn-info" onclick="saveCurrentConfig()">
                        <span>ğŸ’¾</span> ä¿å­˜é…ç½®
                    </button>
                </div>
            </div>

            <!-- AIåŠ©æ‰‹é…ç½® -->
            <div class="card">
                <h2>ğŸ¤– AI åŠ©æ‰‹é…ç½®</h2>
                <div class="form-group">
                    <label>API Key</label>
                    <input type="password" id="ai-api-key" placeholder="è¾“å…¥ Moonshot API Key">
                </div>
                <div class="form-group">
                    <label>Base URL</label>
                    <input type="text" id="ai-base-url" value="https://api.moonshot.cn/v1" placeholder="https://api.moonshot.cn/v1">
                </div>
                <div class="form-group">
                    <label>æ¨¡å‹</label>
                    <select id="ai-model" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                        <option value="moonshot-v1-8k-vision-preview">moonshot-v1-8k-vision-preview</option>
                        <option value="moonshot-v1-32k-vision-preview">moonshot-v1-32k-vision-preview</option>
                        <option value="moonshot-v1-128k-vision-preview">moonshot-v1-128k-vision-preview</option>
                    </select>
                </div>
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="saveAIConfig()">
                        <span>ğŸ’¾</span> ä¿å­˜ AI é…ç½®
                    </button>
                    <button class="btn btn-success" onclick="testAIConfig()">
                        <span>ğŸ§ª</span> æµ‹è¯•è¿æ¥
                    </button>
                </div>
            </div>
        </div>

        <!-- AIåŠ©æ‰‹ - ä¾§è¾¹æ å¸ƒå±€ -->
        <div id="ai-assistant" class="tab-content">
            <div class="ai-chat-layout">
                <!-- å·¦ä¾§èŠå¤©å†å²åˆ—è¡¨ -->
                <div class="chat-sidebar">
                    <div class="sidebar-header">
                        <h3>ğŸ’¬ å¯¹è¯å†å²</h3>
                        <button class="btn-new-chat" onclick="startNewChat()">
                            <span>â•</span> æ–°å¯¹è¯
                        </button>
                    </div>
                    <div class="chat-list" id="chat-list">
                        <div class="chat-item active" onclick="selectChat(0)">
                            <div class="chat-item-icon">ğŸ¤–</div>
                            <div class="chat-item-info">
                                <div class="chat-item-title">é»˜è®¤å¯¹è¯</div>
                                <div class="chat-item-preview">è¿˜æ²¡æœ‰æ¶ˆæ¯</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å³ä¾§ä¸»èŠå¤©åŒºåŸŸ -->
                <div class="chat-main">
                    <!-- èŠå¤©æ ‡é¢˜æ  -->
                    <div class="chat-main-header">
                        <h2>ğŸ¤– Kimi è§†è§‰åŠ©æ‰‹</h2>
                        <div class="header-actions">
                            <button class="btn-clear-current" onclick="clearCurrentChat()">
                                <span>ğŸ—‘ï¸</span> æ¸…ç©ºå½“å‰
                            </button>
                        </div>
                    </div>

                    <!-- èŠå¤©å†…å®¹åŒº -->
                    <div id="chat-history" class="chat-container">
                        <div class="chat-empty">
                            <div class="chat-empty-icon">ğŸ¤–</div>
                            <div class="chat-empty-text">å¼€å§‹æ–°å¯¹è¯å§ï¼<br>ä¸Šä¼ å›¾ç‰‡å¹¶æé—®</div>
                        </div>
                    </div>

                    <!-- å›ºå®šåº•éƒ¨è¾“å…¥åŒº - é›†æˆå›¾ç‰‡ä¸Šä¼  -->
                    <div class="ai-input-fixed">
                        <!-- å›¾ç‰‡é¢„è§ˆ -->
                        <div id="image-preview" style="display: none;" class="input-image-preview">
                            <div class="input-image-container">
                                <img id="preview-img" class="input-preview-image">
                                <button class="remove-image-btn" onclick="removeImage()">Ã—</button>
                            </div>
                        </div>

                        <!-- è¾“å…¥åŒºåŸŸ -->
                        <div class="ai-input-container">
                            <button class="btn-attach" onclick="document.getElementById('ai-image-input').click()">
                                <span>ğŸ“</span>
                            </button>
                            <textarea id="ai-question" rows="1" placeholder="è¯·è¾“å…¥æ‚¨æƒ³è¯¢é—®çš„é—®é¢˜..." class="ai-textarea-fixed" oninput="autoResize(this)" onkeydown="handleKeyDown(event)"></textarea>
                            <button class="btn-send" id="btn-send" onclick="askAI()">
                                <span>â¤</span>
                            </button>
                            <input type="file" id="ai-image-input" accept="image/*" onchange="previewImage(this)" style="display: none;">
                        </div>
                        <div class="ai-input-hint">
                            æ”¯æŒå›¾ç‰‡ä¸Šä¼ ï¼ŒKimi AI å¯ä»¥åˆ†æå›¾ç‰‡å†…å®¹
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é…ç½®
        let statusInterval = null;
        let API_BASE = 'http://127.0.0.1:5000';
        let currentConfig = {
            python_executable: '',
            project_dir: '',
            jupyter_port: 8888
        };
        let draggedFolderName = ''; // è®°å½•æ‹–æ‹½çš„æ–‡ä»¶å¤¹å

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logContainer = document.getElementById('log-container');
            if (!logContainer) return;

            const time = new Date().toLocaleTimeString();
            const logLine = document.createElement('div');
            logLine.className = `log-line log-${type}`;
            logLine.innerHTML = `<span class="log-time">[${time}]</span> ${message}`;
            logContainer.appendChild(logContainer.firstChild); // æ·»åŠ åˆ°å¼€å¤´
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // æ›´æ–°çŠ¶æ€UI
        function updateStatusUI(data) {
            const isRunning = data.running;

            console.log('=== DEBUG: updateStatusUI ===');
            console.log('isRunning:', isRunning);
            console.log('data:', data);

            // å®‰å…¨åœ°æ›´æ–°æ‰€æœ‰å…ƒç´ 
            const jupyterStatus = document.getElementById('jupyter-status');
            if (jupyterStatus) {
                jupyterStatus.textContent = isRunning ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢';
                jupyterStatus.className = `status-badge ${isRunning ? 'status-running' : 'status-stopped'}`;
            }

            const statusValue = document.getElementById('status-value');
            if (statusValue) {
                statusValue.textContent = isRunning ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢';
            }

            const portValue = document.getElementById('port-value');
            if (portValue) {
                portValue.textContent = data.port || '-';
            }

            const pidValue = document.getElementById('pid-value');
            if (pidValue) {
                pidValue.textContent = data.pid || '-';
            }

            const urlValue = document.getElementById('url-value');
            if (urlValue) {
                urlValue.textContent = data.url || '-';
            }

            // æ›´æ–°é…ç½®ä¿¡æ¯æ˜¾ç¤º
            if (data.config) {
                currentConfig = data.config;
                if (data.config.project_dir) {
                    // æŸ¥æ‰¾å¹¶æ›´æ–°æ‰€æœ‰é¡¹ç›®ç›®å½•ç›¸å…³å…ƒç´ 
                    const currentProjectDir = document.getElementById('current-project-dir');
                    const projectDirInput = document.getElementById('config-project-dir');
                    const mainProjectDirInput = document.getElementById('project-path');
                    if (currentProjectDir) {
                        currentProjectDir.textContent = data.config.project_dir;
                    }
                    if (projectDirInput && !projectDirInput.value) {
                        projectDirInput.value = data.config.project_dir;
                    }
                    // åªåœ¨ä¸»æ§åˆ¶å°è¾“å…¥æ¡†ä¸ºç©ºæ—¶æ‰è‡ªåŠ¨å¡«å……
                    if (mainProjectDirInput && !mainProjectDirInput.value) {
                        mainProjectDirInput.value = data.config.project_dir;
                    }
                }
            }

            // æ›´æ–°æŒ‰é’®çŠ¶æ€ - åªæ›´æ–°æ ·å¼ï¼Œä¸è®¾ç½®disabled
            // è¿™æ ·ç”¨æˆ·å¯ä»¥ç‚¹å‡»æŒ‰é’®ï¼Œç”±å‡½æ•°å†…éƒ¨åˆ¤æ–­çŠ¶æ€
            const startBtn = document.getElementById('start-btn');
            const stopBtn = document.getElementById('stop-btn');
            const restartBtn = document.getElementById('restart-btn');
            const openBtn = document.getElementById('open-btn');

            console.log('=== DEBUG: Jupyter is running:', isRunning === true ? 'YES' : 'NO', '===');

            // æ›´æ–°æŒ‰é’®æ ·å¼ï¼ˆè§†è§‰åé¦ˆï¼‰
            if (startBtn) {
                startBtn.style.opacity = isRunning ? '0.5' : '1';
            }
            if (stopBtn) {
                stopBtn.style.opacity = isRunning ? '1' : '0.5';
            }
            if (restartBtn) {
                restartBtn.style.opacity = isRunning ? '1' : '0.5';
            }
            if (openBtn) {
                openBtn.style.opacity = isRunning ? '1' : '0.5';
            }
        }

        // API è°ƒç”¨å‡½æ•°
        async function apiCall(endpoint, options = {}) {
            const url = `${API_BASE}${endpoint}`;
            console.log('=== API CALL DEBUG ===');
            console.log('URL:', url);
            console.log('Options:', options);
            console.log('API_BASE:', API_BASE);
            console.log('=====================');

            try {
                const response = await fetch(url, {
                    headers: { 'Content-Type': 'application/json' },
                    ...options
                });

                console.log('=== API RESPONSE ===');
                console.log('Status:', response.status);
                console.log('StatusText:', response.statusText);
                console.log('OK:', response.ok);
                console.log('===================');

                if (!response.ok) {
                    const text = await response.text();
                    console.error('Error response body:', text);
                    log(`API é”™è¯¯ ${response.status}: ${response.statusText}`, 'error');
                    log(`å“åº”å†…å®¹: ${text}`, 'error');
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                console.error('=== API ERROR ===');
                console.error('Error:', error);
                console.error('Message:', error.message);
                console.error('Stack:', error.stack);
                log(`API è°ƒç”¨å¤±è´¥: ${error.message}`, 'error');
                throw error;
            }
        }

        // è·å–çŠ¶æ€
        async function refreshStatus() {
            console.log('=== refreshStatus() called ===');
            try {
                const data = await apiCall('/api/status');
                console.log('Status data received:', data);
                updateStatusUI(data);
                const apiStatusEl = document.getElementById('api-status');
                if (apiStatusEl) {
                    apiStatusEl.textContent = 'æ­£å¸¸';
                    apiStatusEl.style.color = '#16a34a';
                }
                console.log('API status set to: æ­£å¸¸');
            } catch (error) {
                console.error('refreshStatus error:', error);
                const apiStatusEl = document.getElementById('api-status');
                if (apiStatusEl) {
                    apiStatusEl.textContent = 'è¿æ¥å¤±è´¥';
                    apiStatusEl.style.color = '#dc2626';
                }
            }
        }

        // å¯åŠ¨ Jupyter
        // åœæ­¢ Jupyter
        async function stopJupyter() {
            console.log('=== stopJupyter() called ===');

            // æ£€æŸ¥æ˜¯å¦æœªè¿è¡Œ
            try {
                const status = await apiCall('/api/status');
                if (!status.running) {
                    log('âš ï¸ Jupyter Notebook æœªè¿è¡Œï¼', 'warning');
                    return;
                }
            } catch (e) {
                log('âš ï¸ æ— æ³•æ£€æŸ¥çŠ¶æ€ï¼Œå°è¯•åœæ­¢...', 'warning');
            }

            const btn = document.getElementById('stop-btn');
            btn.style.opacity = '0.5';
            btn.innerHTML = '<span>â³</span> åœæ­¢ä¸­...';
            log('æ­£åœ¨åœæ­¢ Jupyter Notebook...', 'info');

            try {
                const result = await apiCall('/api/stop', { method: 'POST' });
                if (result.success) {
                    log('âœ… Jupyter Notebook å·²åœæ­¢', 'success');
                    await refreshStatus();
                } else {
                    log('âŒ åœæ­¢å¤±è´¥', 'error');
                }
            } catch (error) {
                log(`âŒ åœæ­¢å¤±è´¥: ${error.message}`, 'error');
            } finally {
                btn.style.opacity = '1';
                btn.innerHTML = '<span>â¹</span> åœæ­¢ Jupyter';
            }
        }

        // é‡å¯ Jupyter
        async function restartJupyter() {
            log('æ­£åœ¨é‡å¯ Jupyter Notebook...', 'info');
            log('â†’ ç¬¬ä¸€æ­¥ï¼šåœæ­¢ Notebook', 'info');
            await stopJupyter();
            log('â†’ ç¬¬äºŒæ­¥ï¼šç­‰å¾… 2 ç§’', 'info');
            await new Promise(resolve => setTimeout(resolve, 2000));
            log('â†’ ç¬¬ä¸‰æ­¥ï¼šé‡æ–°å¯åŠ¨', 'info');
            await startJupyter();
        }

        // æ‰“å¼€æµè§ˆå™¨
        function openBrowser() {
            const status = document.getElementById('status-value').textContent;
            const url = document.getElementById('url-value').textContent;
            if (status === 'è¿è¡Œä¸­' && url !== '-') {
                log(`æ­£åœ¨æ‰“å¼€æµè§ˆå™¨: ${url}`, 'info');
                window.open(url, '_blank');
            } else {
                log('âŒ Jupyter Notebook æœªè¿è¡Œï¼Œæ— æ³•æ‰“å¼€æµè§ˆå™¨', 'error');
            }
        }

        // æ£€æµ‹ Python ç¯å¢ƒ
        async function detectEnvironment() {
            try {
                const result = await apiCall('/api/detect_python');
                if (result.success) {
                    document.getElementById('python-version').textContent = result.info.python_version || '-';
                    document.getElementById('jupyter-version').textContent = result.info.jupyterlab_version || '-';
                    document.getElementById('os-info').textContent = result.info.platform || '-';

                    // å¦‚æœæ²¡æœ‰è®¾ç½® Python è·¯å¾„ï¼Œä½¿ç”¨æ£€æµ‹åˆ°çš„è·¯å¾„
                    if (!document.getElementById('config-python-path').value) {
                        document.getElementById('config-python-path').value = result.info.python_executable;
                    }

                    log('âœ… ç¯å¢ƒæ£€æµ‹æˆåŠŸ', 'success');
                } else {
                    log('âŒ ç¯å¢ƒæ£€æµ‹å¤±è´¥', 'error');
                }
            } catch (error) {
                log('âŒ ç¯å¢ƒæ£€æµ‹å¤±è´¥', 'error');
            }
        }

        // æ‹–æ‹½å¤„ç†
        function setupDragAndDrop() {
            const dropZone = document.getElementById('drop-zone');
            const folderInput = document.getElementById('folder-input');

            // é˜²æ­¢é»˜è®¤è¡Œä¸º
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            // é«˜äº®æ‹–æ‹½åŒºåŸŸ
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });

            function highlight() {
                dropZone.classList.add('dragover');
            }

            function unhighlight() {
                dropZone.classList.remove('dragover');
            }

            // å¤„ç†æ–‡ä»¶å¤¹æ”¾ç½®
            dropZone.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;

                if (files.length > 0) {
                    handleFolderSelection(files);
                }
            }

            // å¤„ç†æ–‡ä»¶é€‰æ‹©
            folderInput.addEventListener('change', function(e) {
                handleFolderSelection(e.target.files);
            });
        }

        // å¤„ç†æ–‡ä»¶å¤¹é€‰æ‹©
        function handleFolderSelection(files) {
            if (files.length > 0) {
                const firstFile = files[0];
                let folderName = '';
                let relativePath = '';

                // å°è¯•è·å–ç›¸å¯¹è·¯å¾„
                if (firstFile.webkitRelativePath) {
                    relativePath = firstFile.webkitRelativePath;
                    const pathParts = relativePath.split('/');
                    folderName = pathParts[0] || '';
                }

                if (folderName) {
                    draggedFolderName = folderName;
                    log(`ğŸ“ å·²é€‰æ‹©æ–‡ä»¶å¤¹: ${folderName}`, 'info');
                    log(`ğŸ“Š æ£€æµ‹åˆ° ${files.length} ä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹`, 'info');
                    log(`ğŸ“‚ ç›¸å¯¹è·¯å¾„: ${relativePath}`, 'info');

                    // æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨
                    displayFileList(files);

                    // æ¸…ç©ºé¡¹ç›®è·¯å¾„è¾“å…¥æ¡†
                    const projectPathInput = document.getElementById('project-path');
                    if (projectPathInput) {
                        projectPathInput.value = '';
                        projectPathInput.focus();
                    }
                } else {
                    log('âŒ æ— æ³•è·å–æ–‡ä»¶å¤¹åç§°', 'error');
                }
            }
        }

        // æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨
        function displayFileList(files) {
            const fileListDiv = document.getElementById('file-list');
            const fileListContent = document.getElementById('file-list-content');

            if (!fileListDiv || !fileListContent) return;

            // æŒ‰è·¯å¾„æ’åº
            const sortedFiles = Array.from(files).sort((a, b) => {
                const pathA = a.webkitRelativePath || a.name;
                const pathB = b.webkitRelativePath || b.name;
                return pathA.localeCompare(pathB);
            });

            // é™åˆ¶æ˜¾ç¤ºå‰50ä¸ªæ–‡ä»¶
            const maxFiles = 50;
            const displayFiles = sortedFiles.slice(0, maxFiles);

            // ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨HTML
            let html = '';
            displayFiles.forEach((file, index) => {
                const filePath = file.webkitRelativePath || file.name;
                const fileName = filePath.split('/').pop() || file.name;
                const fileSize = formatFileSize(file.size);

                // ç¼©è¿›æ˜¾ç¤ºå­æ–‡ä»¶å¤¹ç»“æ„
                const depth = filePath.split('/').length - 1;
                const indent = '  '.repeat(depth);

                html += `<div class="file-item">`;
                html += `<span class="file-name">${indent}${fileName}</span>`;
                html += `<span class="file-info">${fileSize}</span>`;
                html += `</div>`;
            });

            // å¦‚æœæœ‰æ›´å¤šæ–‡ä»¶ï¼Œæ˜¾ç¤ºæç¤º
            if (sortedFiles.length > maxFiles) {
                html += `<div class="file-item" style="color: #999; font-style: italic;">`;
                html += `... è¿˜æœ‰ ${sortedFiles.length - maxFiles} ä¸ªæ–‡ä»¶`;
                html += `</div>`;
            }

            if (html) {
                fileListContent.innerHTML = html;
                fileListDiv.style.display = 'block';
            }
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // è·å–å½“å‰ç”¨æˆ·åï¼ˆç”¨äºç”Ÿæˆè·¯å¾„æ¨¡æ¿ï¼‰
        function getUserName() {
            // å°è¯•ä»è·¯å¾„ä¸­æå–ç”¨æˆ·å
            // è¿™æ˜¯ä¸€ä¸ªå¯å‘å¼æ–¹æ³•ï¼Œä¸æ˜¯ç»å¯¹å‡†ç¡®çš„
            const paths = ['C:\\Users\\', 'C:\\Documents and Settings\\'];
            for (let basePath of paths) {
                // è¿™é‡Œåªèƒ½è¿”å›é»˜è®¤å€¼ï¼Œå®é™…è·¯å¾„éœ€è¦ç”¨æˆ·ç¡®è®¤
            }
            return 'User'; // é»˜è®¤å€¼
        }

        // ç¡®è®¤é¡¹ç›®è·¯å¾„
        function confirmProjectPath() {
            const projectPath = document.getElementById('project-path').value.trim();

            if (!projectPath) {
                log('âš ï¸ è¯·è¾“å…¥é¡¹ç›®ç›®å½•è·¯å¾„', 'warning');
                alert('è¯·è¾“å…¥é¡¹ç›®ç›®å½•è·¯å¾„');
                return;
            }

            // éªŒè¯è·¯å¾„æ ¼å¼ï¼ˆç®€å•æ£€æŸ¥ï¼‰
            if (!projectPath.includes(':\\') && !projectPath.startsWith('/')) {
                log('âš ï¸ è·¯å¾„æ ¼å¼å¯èƒ½ä¸æ­£ç¡®ï¼ˆå»ºè®®ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼‰', 'warning');
            }

            // æ›´æ–°å½“å‰é…ç½®
            currentConfig.project_dir = projectPath;
            log('âœ… é¡¹ç›®è·¯å¾„å·²ç¡®è®¤', 'success');
            log(`   è·¯å¾„: ${projectPath}`, 'success');
            alert('é¡¹ç›®è·¯å¾„ç¡®è®¤æˆåŠŸï¼\n\nè·¯å¾„: ' + projectPath + '\n\nç°åœ¨å¯ä»¥ç‚¹å‡»"å¯åŠ¨ Notebook"æŒ‰é’®ï¼ŒJupyter å°†åœ¨æ­¤ç›®å½•å¯åŠ¨ã€‚');
        }

        // ä¿å­˜é…ç½®
        async function saveCurrentConfig() {
            const pythonPath = document.getElementById('config-python-path').value;
            const projectPath = document.getElementById('project-path').value;

            log('ğŸ” æ­£åœ¨ä¿å­˜é…ç½®...', 'info');
            log(`   Pythonè·¯å¾„: ${pythonPath || 'ä½¿ç”¨é»˜è®¤'}`, 'info');
            log(`   é¡¹ç›®ç›®å½•: ${projectPath || 'ä½¿ç”¨é»˜è®¤'}`, 'info');

            try {
                const config = {};
                if (pythonPath) config.python_executable = pythonPath;
                if (projectPath) config.project_dir = projectPath;

                log(`ğŸ“¤ å‘é€åˆ°API: ${JSON.stringify(config)}`, 'info');

                const result = await apiCall('/api/save_config', {
                    method: 'POST',
                    body: JSON.stringify(config)
                });

                log(`ğŸ“¥ APIå“åº”: ${JSON.stringify(result)}`, 'info');

                if (result.success) {
                    log('âœ… é…ç½®å·²ä¿å­˜', 'success');
                    if (result.config) {
                        log(`   Python: ${result.config.python_executable || 'é»˜è®¤'}`, 'success');
                        log(`   é¡¹ç›®: ${result.config.project_dir || 'é»˜è®¤'}`, 'success');
                    }
                    // æ˜¾ç¤ºç”¨æˆ·ç¡®è®¤å¼¹çª—
                    alert('âœ… é…ç½®ä¿å­˜æˆåŠŸï¼\n\n' +
                          (result.config ?
                          `Pythonè·¯å¾„: ${result.config.python_executable || 'é»˜è®¤'}\n` +
                          `é¡¹ç›®ç›®å½•: ${result.config.project_dir || 'é»˜è®¤'}\n` : '') +
                          '\né…ç½®å·²ç”Ÿæ•ˆï¼Œä¸‹æ¬¡å¯åŠ¨ Jupyter æ—¶å°†ä½¿ç”¨æ–°é…ç½®ã€‚');
                } else {
                    log(`âŒ ä¿å­˜å¤±è´¥: ${result.message}`, 'error');
                    // æ˜¾ç¤ºé”™è¯¯å¼¹çª—
                    alert('âŒ é…ç½®ä¿å­˜å¤±è´¥ï¼\n\né”™è¯¯ä¿¡æ¯: ' + (result.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                log(`âŒ ä¿å­˜å¤±è´¥: ${error.message}`, 'error');
                // æ˜¾ç¤ºå¼‚å¸¸é”™è¯¯å¼¹çª—
                alert('âŒ é…ç½®ä¿å­˜å‡ºç°å¼‚å¸¸ï¼\n\né”™è¯¯ä¿¡æ¯: ' + (error.message || 'æœªçŸ¥é”™è¯¯') + '\n\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIæœåŠ¡å™¨çŠ¶æ€ã€‚');
            }
        }

        // ========== AIåŠ©æ‰‹åŠŸèƒ½ ==========

        // ä¿å­˜AIé…ç½®
        function saveAIConfig() {
            const apiKey = document.getElementById('ai-api-key').value;
            const baseUrl = document.getElementById('ai-base-url').value;
            const model = document.getElementById('ai-model').value;

            if (!apiKey) {
                alert('è¯·è¾“å…¥ API Key');
                return;
            }

            const config = {
                api_key: apiKey,
                base_url: baseUrl,
                model: model
            };

            localStorage.setItem('ai_config', JSON.stringify(config));
            alert('AI é…ç½®å·²ä¿å­˜');
        }

        // æµ‹è¯•AIé…ç½®
        function testAIConfig() {
            const config = JSON.parse(localStorage.getItem('ai_config') || '{}');
            if (!config.api_key) {
                alert('è¯·å…ˆé…ç½® API Key');
                return;
            }
            alert('AI é…ç½®å·²ä¿å­˜ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨');
        }

        // é¢„è§ˆå›¾ç‰‡
        function previewImage(input) {
            const previewDiv = document.getElementById('image-preview');
            const previewImg = document.getElementById('preview-img');

            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();

                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    previewDiv.style.display = 'block';
                }

                reader.readAsDataURL(file);
            }
        }

        // åˆ é™¤å›¾ç‰‡
        function removeImage() {
            const previewDiv = document.getElementById('image-preview');
            const imageInput = document.getElementById('ai-image-input');

            previewDiv.style.display = 'none';
            imageInput.value = '';
        }

        // å¼€å§‹æ–°å¯¹è¯
        function startNewChat() {
            // æ¸…ç©ºå½“å‰å¯¹è¯
            clearCurrentChat();
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ åˆ›å»ºæ–°å¯¹è¯çš„é€»è¾‘
        }

        // åˆ‡æ¢å¯¹è¯
        function selectChat(index) {
            // ç§»é™¤æ‰€æœ‰activeç±»
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            // æ·»åŠ activeç±»åˆ°é€‰ä¸­çš„é¡¹
            event.currentTarget.classList.add('active');
            // è¿™é‡Œå¯ä»¥åŠ è½½å¯¹åº”çš„èŠå¤©è®°å½•
        }

        // æ¸…ç©ºå½“å‰å¯¹è¯
        function clearCurrentChat() {
            const chatHistory = document.getElementById('chat-history');
            chatHistory.innerHTML = `
                <div class="chat-empty">
                    <div class="chat-empty-icon">ğŸ¤–</div>
                    <div class="chat-empty-text">å¼€å§‹æ–°å¯¹è¯å§ï¼<br>ä¸Šä¼ å›¾ç‰‡å¹¶æé—®</div>
                </div>
            `;
            document.getElementById('ai-image-input').value = '';
            document.getElementById('ai-question').value = '';
            document.getElementById('image-preview').style.display = 'none';
        }

        // å¤„ç†é”®ç›˜äº‹ä»¶
        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                askAI();
            }
        }

        // å¯åŠ¨ Jupyter
        async function startJupyter() {
            console.log('=== startJupyter() called ===');

            // æ£€æŸ¥æ˜¯å¦å·²è¿è¡Œ
            try {
                const status = await apiCall('/api/status');
                if (status.running) {
                    log('âš ï¸ Jupyter Notebook å·²åœ¨è¿è¡Œä¸­ï¼', 'warning');
                    return;
                }
            } catch (e) {
                log('âš ï¸ æ— æ³•æ£€æŸ¥çŠ¶æ€ï¼Œå°è¯•å¯åŠ¨...', 'warning');
            }

            const btn = document.getElementById('start-btn');
            btn.style.opacity = '0.5';
            btn.innerHTML = '<span>â³</span> å¯åŠ¨ä¸­...';
            log('æ­£åœ¨å¯åŠ¨ Jupyter Notebook...', 'info');

            try {
                const port = parseInt(document.getElementById('config-port').value) || 8888;
                const pythonPath = document.getElementById('config-python-path').value;
                // ä¼˜å…ˆä½¿ç”¨å‰ç«¯è¾“å…¥æ¡†ä¸­çš„é¡¹ç›®è·¯å¾„ï¼Œå…¶æ¬¡ä½¿ç”¨é…ç½®ä¸­çš„è·¯å¾„
                const projectDirInput = document.getElementById('project-path');
                const enteredPath = projectDirInput && projectDirInput.value ? projectDirInput.value.trim() : '';
                const projectDir = enteredPath || (currentConfig.project_dir ? currentConfig.project_dir.trim() : '');
                const looksLikeNotebook = projectDir && projectDir.toLowerCase().endsWith('.ipynb');

                if (enteredPath) {
                    currentConfig.project_dir = enteredPath;
                }

                console.log('=== å¯åŠ¨å‚æ•°æ”¶é›† ===');
                console.log('port:', port);
                console.log('pythonPath:', pythonPath);
                console.log('projectDir (å‰ç«¯è¾“å…¥æ¡†):', projectDirInput ? projectDirInput.value : '(ç©º)');
                console.log('projectDir (å®é™…ä½¿ç”¨):', projectDir);
                console.log('currentConfig:', currentConfig);
                console.log('====================');

                log('='.repeat(60), 'info');
                log('ğŸ“‹ å¯åŠ¨å‚æ•°è¯¦æƒ…:', 'info');
                log(`   â”œâ”€ ç«¯å£: ${port}`, 'info');
                log(`   â”œâ”€ Pythonè·¯å¾„ (è¾“å…¥æ¡†): ${pythonPath || '(ç©º)'}`, 'info');
                log(`   â”œâ”€ é¡¹ç›®/æ–‡ä»¶è·¯å¾„: ${projectDir || '(ç©º)'}`, 'info');
                if (looksLikeNotebook) {
                    log('   â”œâ”€ æ£€æµ‹åˆ° .ipynb æ–‡ä»¶ï¼Œå°†åœ¨å¯åŠ¨åç›´æ¥å®šä½è¯¥ç¬”è®°æœ¬', 'info');
                }
                log(`   â””â”€ å½“å‰é…ç½®: ${JSON.stringify(currentConfig, null, 2)}`, 'info');

                // å‡†å¤‡å¯åŠ¨å‚æ•°
                const startData = { port };
                if (pythonPath) {
                    // Windowsè·¯å¾„åæ–œæ è½¬ä¹‰
                    const escapedPath = pythonPath.replace(/\\/g, '\\\\');
                    startData.python_executable = escapedPath;
                    log(`ğŸ”§ Pythonè·¯å¾„è½¬ä¹‰: ${pythonPath} -> ${escapedPath}`, 'info');
                }
                if (projectDir) {
                    // Windowsè·¯å¾„åæ–œæ è½¬ä¹‰
                    const escapedProjectDir = projectDir.replace(/\\/g, '\\\\');
                    startData.project_dir = escapedProjectDir;
                    log(`ğŸ”§ é¡¹ç›®ç›®å½•è½¬ä¹‰: ${projectDir} -> ${escapedProjectDir}`, 'info');
                    console.log('=== é¡¹ç›®ç›®å½•å·²æ·»åŠ åˆ°startData ===');
                    console.log('åŸå§‹è·¯å¾„:', projectDir);
                    console.log('è½¬ä¹‰å:', escapedProjectDir);
                    console.log('startData.project_dir:', startData.project_dir);
                } else {
                    console.log('=== WARNING: projectDirä¸ºç©º ===');
                    console.log('æœªæŒ‡å®šé¡¹ç›®ç›®å½•ï¼Œå°†ä½¿ç”¨é»˜è®¤ç›®å½•');
                }

                log('ğŸ“¤ æœ€ç»ˆè¯·æ±‚æ•°æ®:', 'info');
                log(`   ${JSON.stringify(startData, null, 2)}`, 'info');
                console.log('=== å®Œæ•´startData ===');
                console.log(startData);
                console.log('==================');

                log('ğŸŒ æ­£åœ¨å‘é€ API è¯·æ±‚...', 'info');
                log(`   åœ°å€: ${API_BASE}/api/start`, 'info');
                log(`   æ–¹æ³•: POST`, 'info');

                const result = await apiCall('/api/start', {
                    method: 'POST',
                    body: JSON.stringify(startData)
                });

                log('ğŸ“¥ æ”¶åˆ° API å“åº”:', 'info');
                log(`   çŠ¶æ€: ${result.success ? 'æˆåŠŸ' : 'å¤±è´¥'}`, result.success ? 'success' : 'error');
                log(`   æ¶ˆæ¯: ${result.message || 'N/A'}`, result.success ? 'success' : 'error');
                log(`   å®Œæ•´æ•°æ®: ${JSON.stringify(result, null, 2)}`, result.success ? 'success' : 'error');

                if (result.success) {
                    log('âœ… Jupyter Notebook å¯åŠ¨æˆåŠŸï¼', 'success');
                    log(`   URL: ${result.url}`, 'success');
                    log(`   è¿›ç¨‹ ID: ${result.pid} | ç«¯å£: ${result.port}`, 'success');
                    if (result.url) log(`   è®¿é—®åœ°å€: ${result.url}`, 'success');
                    await refreshStatus();
                } else {
                    log(`âŒ å¯åŠ¨å¤±è´¥: ${result.message}`, 'error');
                    if (result.error) {
                        log(`   é”™è¯¯è¯¦æƒ…: ${result.error}`, 'error');
                    }
                }
            } catch (error) {
                log(`âŒ å¯åŠ¨å¤±è´¥: ${error.message}`, 'error');
            } finally {
                btn.style.opacity = '1';
                btn.innerHTML = '<span>â–¶</span> å¯åŠ¨ Notebook';
            }
        }

        // å‘AIæé—®
        async function askAI() {
            const config = JSON.parse(localStorage.getItem('ai_config') || '{}');
            if (!config.api_key) {
                alert('è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½® AI API Key');
                return;
            }

            const imageInput = document.getElementById('ai-image-input');
            const question = document.getElementById('ai-question').value;
            const chatHistory = document.getElementById('chat-history');

            if (!imageInput.files || !imageInput.files[0]) {
                alert('è¯·ä¸Šä¼ å›¾ç‰‡');
                return;
            }

            if (!question) {
                alert('è¯·è¾“å…¥é—®é¢˜');
                return;
            }

            const btn = document.getElementById('btn-send');
            btn.disabled = true;
            btn.innerHTML = '<span>â³</span>';
            btn.style.opacity = '0.6';

            try {
                // è½¬æ¢å›¾ç‰‡ä¸ºbase64
                const file = imageInput.files[0];
                const base64 = await fileToBase64(file);

                const response = await apiCall('/api/ai/ask', {
                    method: 'POST',
                    body: JSON.stringify({
                        image: base64,
                        question: question,
                        config: config
                    })
                });

                if (response.success) {
                    // æ·»åŠ åˆ°å¯¹è¯å†å²
                    addToChatHistory(question, response.answer);
                    document.getElementById('ai-question').value = '';
                } else {
                    alert('AI å›ç­”å¤±è´¥: ' + response.message);
                }
            } catch (error) {
                alert('è¯·æ±‚å¤±è´¥: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>â¤</span>';
                btn.style.opacity = '1';
            }
        }

        // æ·»åŠ åˆ°å¯¹è¯å†å² - å‚è€ƒChatGPT
        function addToChatHistory(question, answer) {
            const chatHistory = document.getElementById('chat-history');

            // æ£€æŸ¥æ˜¯å¦ä¸ºç©ºçŠ¶æ€
            if (chatHistory.children.length === 1 && chatHistory.children[0].classList.contains('chat-empty')) {
                chatHistory.innerHTML = '';
            }

            // è·å–å½“å‰æ—¶é—´
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });

            // ç”¨æˆ·é—®é¢˜
            const qDiv = document.createElement('div');
            qDiv.className = 'chat-message question';
            qDiv.innerHTML = `
                <div class="message-avatar user-avatar">
                    <span>ğŸ‘¤</span>
                </div>
                <div class="message-content-wrapper">
                    <div class="message-header">
                        <span class="message-sender">æ‚¨</span>
                        <span class="message-time">${timeString}</span>
                    </div>
                    <div class="message-content">${question}</div>
                </div>
            `;

            // AIå›ç­”
            const aDiv = document.createElement('div');
            aDiv.className = 'chat-message answer';
            aDiv.innerHTML = `
                <div class="message-avatar ai-avatar">
                    <span>ğŸ¤–</span>
                </div>
                <div class="message-content-wrapper">
                    <div class="message-header">
                        <span class="message-sender">Kimi AI</span>
                        <span class="message-time">${timeString}</span>
                    </div>
                    <div class="message-content">${answer}</div>
                </div>
            `;

            chatHistory.appendChild(qDiv);
            chatHistory.appendChild(aDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        // æ¸…ç©ºå¯¹è¯ - è°ƒç”¨ clearCurrentChat
        function clearChat() {
            clearCurrentChat();
        }

        // æ–‡ä»¶è½¬Base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
        }

        // åŠ è½½é…ç½®
        async function loadConfigFromServer() {
            try {
                log('ğŸ” æ­£åœ¨åŠ è½½é…ç½®...', 'info');
                const result = await apiCall('/api/load_config');
                log(`ğŸ“¥ APIå“åº”: ${JSON.stringify(result)}`, 'info');

                if (result.success && result.config) {
                    const config = result.config;
                    log('âœ… æˆåŠŸè·å–é…ç½®', 'success');

                    if (config.python_executable) {
                        document.getElementById('config-python-path').value = config.python_executable;
                        log(`ğŸ“ å·²è®¾ç½®Pythonè·¯å¾„: ${config.python_executable}`, 'info');
                    }

                    if (config.project_dir) {
                        currentConfig.project_dir = config.project_dir;
                        // æŸ¥æ‰¾å¹¶è®¾ç½®æ‰€æœ‰é¡¹ç›®ç›®å½•è¾“å…¥æ¡†
                        const projectPathInput = document.getElementById('project-path');
                        const configProjectDirInput = document.getElementById('config-project-dir');
                        // åªæœ‰åœ¨è¾“å…¥æ¡†ä¸ºç©ºæ—¶æ‰è‡ªåŠ¨å¡«å……
                        if (projectPathInput && !projectPathInput.value) {
                            projectPathInput.value = config.project_dir;
                        }
                        if (configProjectDirInput && !configProjectDirInput.value) {
                            configProjectDirInput.value = config.project_dir;
                        }
                        log(`ğŸ“ å·²è®¾ç½®é¡¹ç›®ç›®å½•: ${config.project_dir}`, 'info');
                        console.log('é¡¹ç›®ç›®å½•å·²è®¾ç½®åˆ°:', config.project_dir);
                    }

                    log('âœ… å·²åŠ è½½ä¿å­˜çš„é…ç½®', 'success');
                } else {
                    log('âŒ æ— æ³•è·å–é…ç½®', 'error');
                }
            } catch (error) {
                log(`âŒ åŠ è½½é…ç½®å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä½¿HTMLä¸­çš„onclickå¯ä»¥è°ƒç”¨
        // è¿™ä¸ªå¿…é¡»åœ¨æ¨¡å—é¡¶éƒ¨ï¼Œç¡®ä¿onclickèƒ½è®¿é—®åˆ°
        window.startJupyter = startJupyter;
        window.stopJupyter = stopJupyter;
        window.restartJupyter = restartJupyter;
        window.openBrowser = openBrowser;
        window.confirmProjectPath = confirmProjectPath;

        // è°ƒè¯•ï¼šæ£€æŸ¥å‡½æ•°æ˜¯å¦å·²æš´éœ²
        console.log('=== DEBUG: Window functions ===');
        console.log('window.startJupyter:', typeof window.startJupyter);
        console.log('window.stopJupyter:', typeof window.stopJupyter);
        console.log('window.restartJupyter:', typeof window.restartJupyter);
        console.log('window.openBrowser:', typeof window.openBrowser);
        console.log('window.confirmProjectPath:', typeof window.confirmProjectPath);

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        window.onload = function() {
            log('âœ… Jupyter Notebook Client å¯åŠ¨å®Œæˆ', 'success');
            log(`ğŸ”— è¿æ¥åˆ° API æœåŠ¡å™¨: ${API_BASE}`, 'info');

            // åˆå§‹åŒ–åŠŸèƒ½
            setupDragAndDrop();
            loadConfigFromServer();
            detectEnvironment();
            refreshStatus();

            // è®¾ç½®å®šæ—¶åˆ·æ–°
            setInterval(() => {
                refreshStatus();
            }, 2000);

            // è°ƒè¯•ï¼šå®šæœŸè¾“å‡ºé…ç½®çŠ¶æ€
            setInterval(() => {
                console.log('=== å½“å‰é…ç½®çŠ¶æ€ ===');
                console.log('currentConfig:', currentConfig);
                console.log('===================');
            }, 5000);

            log('ğŸ’¡ æç¤º: æ¯2ç§’è‡ªåŠ¨åˆ·æ–°çŠ¶æ€', 'info');
            log('ğŸ’¡ æ‹–æ‹½æ–‡ä»¶å¤¹åä¼šè·³è½¬åˆ°è®¾ç½®é¡µé¢', 'info');
            log('ğŸ’¡ åœ¨"è®¾ç½®"ä¸­è¾“å…¥å®Œæ•´é¡¹ç›®è·¯å¾„', 'info');
            log('ğŸš€ å‡†å¤‡å°±ç»ªï¼Œå¼€å§‹ä½¿ç”¨å§ï¼', 'success');

            // è°ƒè¯•ï¼šæ·»åŠ æŒ‰é’®ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ï¼ˆåŒé‡ä¿é™©ï¼‰
            const startBtn = document.getElementById('start-btn');
            const stopBtn = document.getElementById('stop-btn');
            const restartBtn = document.getElementById('restart-btn');
            const openBtn = document.getElementById('open-btn');

            console.log('=== DEBUG: Button elements ===');
            console.log('startBtn:', startBtn);
            console.log('stopBtn:', stopBtn);
            console.log('restartBtn:', restartBtn);
            console.log('openBtn:', openBtn);

            if (startBtn) {
                startBtn.addEventListener('click', function(e) {
                    console.log('=== START BUTTON CLICKED ===');
                    console.log('Button disabled state:', startBtn.disabled);
                    log('ğŸ”” [DEBUG] start-btn clicked via event listener!', 'info');
                    e.preventDefault();
                    e.stopPropagation();
                    startJupyter();
                });
                log('[DEBUG] start-btn äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ ', 'info');
            }

            if (stopBtn) {
                stopBtn.addEventListener('click', function(e) {
                    console.log('=== STOP BUTTON CLICKED ===');
                    console.log('Button disabled state:', stopBtn.disabled);
                    log('ğŸ”” [DEBUG] stop-btn clicked via event listener!', 'info');
                    e.preventDefault();
                    e.stopPropagation();
                    stopJupyter();
                });
                log('[DEBUG] stop-btn äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ ', 'info');
            }

            if (restartBtn) {
                restartBtn.addEventListener('click', function(e) {
                    console.log('=== RESTART BUTTON CLICKED ===');
                    console.log('Button disabled state:', restartBtn.disabled);
                    log('ğŸ”” [DEBUG] restart-btn clicked via event listener!', 'info');
                    e.preventDefault();
                    e.stopPropagation();
                    restartJupyter();
                });
                log('[DEBUG] restart-btn äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ ', 'info');
            }

            if (openBtn) {
                openBtn.addEventListener('click', function(e) {
                    console.log('=== OPEN BUTTON CLICKED ===');
                    console.log('Button disabled state:', openBtn.disabled);
                    log('ğŸ”” [DEBUG] open-btn clicked via event listener!', 'info');
                    e.preventDefault();
                    e.stopPropagation();
                    openBrowser();
                });
                log('[DEBUG] open-btn äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ ', 'info');
            }
        };
    </script>
</body>
</html>
